{% load i18n %}
<script>
    window.addEventListener("load", function() {
        [...document.getElementsByClassName('tag-container')].forEach(el => {
            let id = el.id.replace('show-tags-', '');
            let couldFit = (el.scrollHeight + document.getElementById(`show-summary-${id}`).scrollHeight) < document.getElementById(`work-${id}-tile-container`).scrollHeight;
            if (el.offsetHeight < el.scrollHeight) {
                if (!couldFit) {
                    document.getElementById('more-btn-tags-'+id).style.display = 'inline';
                }
                else {
                    el.style.height = `${el.scrollHeight}px`;
                    el.style.maxHeight = `${el.scrollHeight}px`;
                }
            }
        });
        [...document.getElementsByClassName('summary-container')].forEach(el => {
            if (el.offsetHeight < el.scrollHeight) {
                let id = el.id.replace('show-summary-', '');
                document.getElementById('more-btn-summary-'+id).style.display = 'inline';
            }
        });
    });

    function toggleData(work_id, selector) {
        let overflow = document.getElementById(`show-${selector}-`+work_id).style.overflow;
        let element_id = `show-${selector}-` + work_id;
        let button_id = `more-btn-${selector}-` + work_id;
        if (overflow === 'hidden' || overflow.length < 1) {
            document.getElementById(element_id).style.overflow = 'clip';
            document.getElementById(element_id).style.maxHeight = '2000px';
            document.getElementById(element_id).style.height = 'auto';
            document.getElementById(button_id).innerText = '{% translate "Hide" %}';
        }
        else {
            document.getElementById(element_id).style.overflow = 'hidden';
            document.getElementById(element_id).style.maxHeight = '150px';
            document.getElementById(element_id).style.height = '150px';
            document.getElementById(button_id).innerText = '{% translate "Show more..." %}';
            document.getElementById(element_id).scrollIntoView();
        }
    }
</script>
<div class="ourchive-work-card uk-box-shadow-small uk-height-large uk-width-1-1" id="work-{{work.id}}-tile-container">
    <div class="uk-grid uk-grid-small uk-height-1-1" uk-grid>
        <div class="uk-width-1-3@m uk-width-1-1@s card-info" id="work-{{work.id}}-tile-card">
            <!-- title, author, work type, 1 tag/attribute type, cover -->
            <p class="uk-margin-small-bottom"><span id="work-{{work.id}}-tile-title" class="uk-margin-remove-bottom ourchive-tile-title">
                <a id="work-{{work.id}}-tile-title-link" href="/works/{{work.id}}" data-testid="work-tile-title">{{work.title}}</a>
            </span> </p>
            <p class="uk-margin-remove-bottom uk-margin-small-top"><span id="work-{{ work.id }}-creators>">By
                    {% for user in work.users %}<a id="work-{{work.id}}-user-link" data-testid="work-user-link" href="{% url 'user-profile-parent' user.id %}">{{ user.username }}</a>
                        {% if not forloop.last %}, {% endif %}{% empty %}
                        <a id="work-{{work.id}}-user-link" data-testid="work-user-link" href="{% url 'user-profile-parent' work.user_id %}">{{ work.user }}</a>
                    {% endfor %}
            </span></p>
            <p class="uk-margin-remove-bottom uk-margin-small-top"><span id="work-{{ work.id }}-type" class="ourchive-muted">{{ work.work_type_name }}</span></p>
            <p class="uk-margin-remove-bottom uk-margin-small-top"><span class="uk-inline ourchive-muted uk-text-italic" id="work-metadata-language">{% for language in work.languages_readonly %}{{ language.display_name }}{% if not forloop.last %},{% endif %}
        {% endfor %}</span></p>
            {% if work.cover_url != "None" and work.cover_url is not None and work.cover_url != "" %}
            <div class="uk-width-auto" id="work-{{work.id}}-tile-img-parent">
                <img class="work-tile-cover" alt="{{work.cover_alt_text}}" src="{{work.cover_url}}" id="work-{{work.id}}-tile-image">
            </div>
            {% endif %}
        </div>
        <div class="uk-width-2-3@m uk-width-1-1@s card-info" id="work-{{work.id}}-info-card">
            <!-- summary, tag/attribute group 1, 2, and 3 -->
            {% if work.summary %}
                <div class="uk-height-max-small summary-container" id="show-summary-{{ work.id }}">
                    <p id="work-{{work.id}}-tile-summary-p" class="uk-margin-remove-vertical">{% autoescape off %}{{ work.summary }}{% endautoescape %}</p>
                </div>
                <a class="show-more-btn uk-text-bold uk-margin-small-top" onclick="toggleData('{{ work.id }}', 'summary')" id="more-btn-summary-{{ work.id }}">{% translate 'Show more...' %}</a>
            {% endif %}
            <div class="uk-height-max-small tag-container" id="show-tags-{{ work.id }}">
                {% if work.attributes %}{% include "object_attributes.html" with object='work' object_id=work.id attributes=work.attributes %}{% endif %}
            <hr class="ourchive-hr"/>
                {% if work.tags %}{% include "tag_partial.html" with obj_name='work' tags=work.tags %}{% endif %}
            </div>
            <a class="show-more-btn uk-text-bold uk-margin-small-top" onclick="toggleData('{{ work.id }}', 'tags')" id="more-btn-tags-{{ work.id }}">{% translate 'Show more...' %}</a>
        </div>
        <div class="uk-width-1-1 card-metadata" id="work-{{ work.id }}-list-meta">
            <!-- language, complete status, updated, chapters, word count, comments, fingerguns -->
            {% include 'work_metadata.html' %}
        </div>
    </div>
</div>
