{% load i18n %}
<!--<div class="uk-width-1-1 uk-padding-remove-horizontal" id="work-{{work.id}}-tile-parent">
	<div class="uk-card uk-card-default" id="work-{{work.id}}-tile-card">
	    <div class="uk-card-header uk-padding-small ourchive-card-head" id="work-{{work.id}}-tile-card-header">
	        <div class="uk-grid-small uk-flex-middle" uk-grid id="work-{{work.id}}-tile-card-header-grid">
	            {% if work.cover_url != "None" and work.cover_url is not None and work.cover_url != "" %}
	            <div class="uk-width-auto" id="work-{{work.id}}-tile-img-parent">
	                <img class="uk-border-circle" width="40" height="40" alt="{{work.cover_alt_text}}" src="{{work.cover_url}}" id="work-{{work.id}}-tile-image">
	            </div>
	            {% endif %}
	            <div class="uk-width-expand" id="work-{{work.id}}-tile-title-parent">
	                {% if work.draft == True %}
	                	<span id="work-{{work.id}}-tile-draft-title" class="uk-text-medium uk-margin-remove-bottom uk-inline ourchive-tile-title"><a id="work-{{work.id}}-tile-draft-title-link" data-testid="work-tile-title-draft" href="{% url 'fe-work-view' work.id %}">{% if work.work_type_name %}[{{work.work_type_name}}] {% endif %}{{work.title}}</a> by {% for user in work.users %}<a id="work-{{work.id}}-user-link" href="{% url 'user-profile-parent' user.id %}">{{ user.username }}</a>{% if not forloop.last %}, {% endif %}{% empty %}<a id="work-user-link" href="{% url 'user-profile-parent' work.user_id %}">{{ work.user }}</a>{% endfor %}</span>
		                <p class="uk-label uk-margin-remove-top uk-margin-remove-right uk-margin-remove-left uk-text-small uk-inline uk-label-warning" id="work-{{work.id}}-tile-draft-button-span"><strong>DRAFT</strong></p>
	                {% else %}
	                	<span id="work-{{work.id}}-tile-title" class="uk-margin-remove-bottom uk-inline ourchive-tile-title">
                            <a id="work-{{work.id}}-tile-title-link" href="/works/{{work.id}}" data-testid="work-tile-title">
                                {% if work.work_type_name %}[{{work.work_type_name}}] {% endif %}{{work.title}}</a> by
                                {% for user in work.users %}<a id="work-{{work.id}}-user-link" data-testid="work-user-link" href="{% url 'user-profile-parent' user.id %}">{{ user.username }}</a>
                                    {% if not forloop.last %}, {% endif %}{% empty %}
                                    <a id="work-{{work.id}}-user-link" data-testid="work-user-link" href="{% url 'user-profile-parent' work.user_id %}">{{ work.user }}</a>
                                {% endfor %}
                        </span>
	                {% endif %}
	            </div>
	            {% if work.owner %}
		        <div class="uk-align-right uk-text-right uk-margin-small-top uk-visible@s uk-margin-remove-bottom" id="work-{{work.id}}-header-user-controls">
		            <a id="work-{{work.id}}-header-edit-link" title="Edit Work {{ work.id }}" href="/works/{{ work.id }}/edit" class="ourchive-icon-wrapper"><span id="work={{work.id}}-header-edit-span" uk-icon="icon: ourchive-edit;ratio:.75" title="{% translate 'Edit Work' %} {{ work.id }}"></span></a>
		            <a id="work-{{work.id}}-header-delete-link" uk-toggle="target: #work-{{work.id}}-modal-delete" class="ourchive-icon-wrapper"><span id="work-{{work.id}}-header-delete-span" uk-icon="icon: ourchive-delete;ratio:.75" title="{% translate 'Delete Work' %} {{ work.id }}"></span></a>
		            {% include "delete_modal.html" with object='work' object_id=work.id %}
		        </div>
		        <div class="uk-align-left uk-text-left uk-margin-small-top uk-hidden@s uk-margin-remove-bottom uk-width-1-1" id="work-{{work.id}}-header-user-controls">
		        	<a id="work-{{work.id}}-header-edit-link" title="Edit Work {{ work.id }}" href="/works/{{ work.id }}/edit" class="ourchive-icon-wrapper"><span id="work={{work.id}}-header-edit-span" uk-icon="icon: ourchive-edit;ratio:.75" title="{% translate 'Edit Work' %} {{ work.id }}"></span></a>
		            <a id="work-{{work.id}}-header-delete-link" uk-toggle="target: #work-{{work.id}}-modal-delete" class="ourchive-icon-wrapper"><span id="work-{{work.id}}-header-delete-span" uk-icon="icon: ourchive-delete;ratio:.75" title="{% translate 'Delete Work' %} {{ work.id }}"></span></a>
		            {% include "delete_modal.html" with object='work' object_id=work.id %}
		        </div>
		        {% endif %}
	        </div>
	    </div>
	    {% if work.summary or work.attributes or work.tags %}<div class="uk-card-body ourchive-card-body uk-padding-small" id="work-{{work.id}}-tile-card-body">
	        {% if work.summary %}<p id="work-{{work.id}}-tile-summary-p" class="uk-margin-remove-vertical">{% autoescape off %}{{ work.summary }}{% endautoescape %}</p>{% endif %}
	        {% if work.attributes %}{% include "object_attributes.html" with object='work' object_id=work.id attributes=work.attributes %}{% endif %}
		    {% if work.tags.items %}{% include "tag_partial.html" with obj_name='work' tags=work.tags.items %}{% endif %}
	    </div>{% endif %}
	    <div class="uk-card-footer ourchive-card-footer uk-padding-remove" id="work-{{work.id}}-tile-footer-parent">
	        <div class="uk-width-1-1 uk-padding-small uk-margin-small">{% include 'work_metadata.html' %}</div>
	    </div>

	</div>  
</div> -->
<style>
    .ourchive-work-card {
        border: 1px solid #ccc;
        padding: 15px !important;
    }

    .ourchive-work-card {
        height: auto;
    }

    .ourchive-work-card .card-metadata {
        height: 40px;
    }

    .tag-container {
        overflow:hidden;
    }

    .summary-container {
        overflow:hidden;
    }

.show-more-btn {
    display: none;
}

.work-tile-cover {
    width:80%;
    overflow:hidden;
}

</style>
<script>
    window.addEventListener("load", function() {
        [...document.getElementsByClassName('tag-container')].forEach(el => {
            console.log(el.offsetHeight);
            console.log(el.scrollHeight);
            if (el.offsetHeight < el.scrollHeight) {
                let id = el.id.replace('show-tags-', '');
                document.getElementById('more-btn-tags-'+id).style.display = 'inline';
            }
        });
        [...document.getElementsByClassName('summary-container')].forEach(el => {
            if (el.offsetHeight < el.scrollHeight) {
                let id = el.id.replace('show-summary-', '');
                document.getElementById('more-btn-summary-'+id).style.display = 'inline';
            }
        });
    });

    function toggleData(work_id, selector) {
        let overflow = document.getElementById(`show-${selector}-`+work_id).style.overflow;
        let element_id = `show-${selector}-` + work_id;
        let button_id = `more-btn-${selector}-` + work_id;
        if (overflow === 'hidden' || overflow.length < 1) {
            document.getElementById(element_id).style.overflow = 'clip';
            document.getElementById(element_id).style.maxHeight = '1200px';
            document.getElementById(element_id).style.height = 'auto';
            document.getElementById(button_id).innerText = '{% translate "Hide" %}';
        }
        else {
            document.getElementById(element_id).style.overflow = 'hidden';
            document.getElementById(element_id).style.maxHeight = '150px';
            document.getElementById(element_id).style.height = '150px';
            document.getElementById(button_id).innerText = '{% translate "Show more..." %}';
            document.getElementById(element_id).scrollIntoView();
        }
    }
</script>
<div class="ourchive-work-card uk-box-shadow-small uk-width-1-1">
    <div class="uk-grid uk-grid-small uk-height-1-1" uk-grid>
        <div class="uk-width-1-3@m uk-width-1-1@s card-info" id="work-{{work.id}}-tile-card">
            <!-- title, author, work type, 1 tag/attribute type, cover -->
            <p><span id="work-{{work.id}}-tile-title" class="uk-margin-remove-bottom ourchive-tile-title">
                <a id="work-{{work.id}}-tile-title-link" href="/works/{{work.id}}" data-testid="work-tile-title">{{work.title}}</a>
            </span> </p>
            <p><span id="work-{{ work.id }}-creators>">By
                    {% for user in work.users %}<a id="work-{{work.id}}-user-link" data-testid="work-user-link" href="{% url 'user-profile-parent' user.id %}">{{ user.username }}</a>
                        {% if not forloop.last %}, {% endif %}{% empty %}
                        <a id="work-{{work.id}}-user-link" data-testid="work-user-link" href="{% url 'user-profile-parent' work.user_id %}">{{ work.user }}</a>
                    {% endfor %}
            </span></p>
            <p><span id="work-{{ work.id }}-type" class="uk-text-meta">{{ work.work_type_name }}</span></p>
            {% if work.cover_url != "None" and work.cover_url is not None and work.cover_url != "" %}
            <div class="uk-width-auto" id="work-{{work.id}}-tile-img-parent">
                <img class="work-tile-cover" alt="{{work.cover_alt_text}}" src="{{work.cover_url}}" id="work-{{work.id}}-tile-image">
            </div>
            {% endif %}
        </div>
        <div class="uk-width-2-3@m uk-width-1-1@s card-info" id="work-{{work.id}}-info-card">
            <!-- summary, tag/attribute group 1, 2, and 3 -->
            {% if work.summary %}
                <div class="uk-height-max-small summary-container" id="show-summary-{{ work.id }}">
                    <p id="work-{{work.id}}-tile-summary-p" class="uk-margin-remove-vertical">{% autoescape off %}{{ work.summary }}{% endautoescape %}</p>
                </div>
                <button class="show-more-btn" onclick="toggleData('{{ work.id }}', 'summary')" id="more-btn-summary-{{ work.id }}">{% translate 'Show more...' %}</button>
            {% endif %}
            <div class="uk-height-max-small tag-container" id="show-tags-{{ work.id }}">
                {% if work.attributes %}{% include "object_attributes.html" with object='work' object_id=work.id attributes=work.attributes %}{% endif %}
                {% if work.tags.items %}{% include "tag_partial.html" with obj_name='work' tags=work.tags.items %}{% endif %}
            </div>
            <button class="show-more-btn" onclick="toggleData('{{ work.id }}', 'tags')" id="more-btn-tags-{{ work.id }}">{% translate 'Show more...' %}</button>
        </div>
        <div class="uk-width-1-1 card-metadata" id="work-{{ work.id }}-list-meta">
            <!-- language, complete status, updated, chapters, word count, comments, fingerguns -->
            {% include 'work_metadata.html' %}
        </div>
    </div>
</div>
