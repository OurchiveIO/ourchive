<div class="uk-child-width-1@m uk-child-width-1@s uk-text-left" uk-grid>
	<script>
		function loadMoreComments(next, chapterId) {
			fetch(next)
			  .then((response) => {
			    return response.text();
			  })
			  .then((myText) => {			 
				container_block = document.getElementById( 'chapter-'+chapterId+'-comments-list' );
				container_block.innerHTML += myText;
			  });
		}
	</script>
	<div class="uk-width-2-3">
		<h2><a class="uk-link-reset" href="">Chapter {{ chapter.number }}: {{ chapter.title }}</a></h2>
		{% if chapter.draft %}
	            <div class="uk-width-auto">
	                <span class="uk-label uk-label-warning"><strong>DRAFT</strong></span>
	            </div>
	    {% endif %}
	</div>	
	
	<div class="uk-text-right uk-width-1-3">
            {% if work.user == request.user.username %}
            {% if chapter.draft %}
            <a href="/works/{{ work.id }}/chapters/{{ chapter.id }}/publish"><span uk-icon="icon: check" title="Publish"></span> </a>
            {% endif %}
            <a href="/works/{{ work.id }}/chapters/{{ chapter.id }}/edit"><span uk-icon="icon: file-edit"></span> </a>
            <a href="/works/{{work.id}}/chapters/{{ chapter.id }}/delete"><span uk-icon="icon: trash"></span> </a>
            {% endif %}
    </div>
    <div class="uk-grid-column-small uk-grid-row-small uk-child-width-1-1@s" uk-grid>
		<div><span class="uk-text-large">Summary</span></div>
	    <div><span class="uk-text-medium">{% autoescape off %}{{ chapter.summary }}{% endautoescape %}</span></div>
		<div><span class="uk-text-large">Notes</span></div>
	    <div><span class="uk-text-medium">{% autoescape off %}{{ chapter.notes }}{% endautoescape %}</span></div>
	</div>
   	<hr/>	
	{% if chapter.image_url %}<p><img src="{{ chapter.image_url }}" alt="{{ chapter.image_alt_text }}"/></p><hr/>{% endif %}
	{% if chapter.audio_url %}<p><audio src="{{ chapter.audio_url }}" controls></audio></p><hr/>{% endif %}
	{% if chapter.text %}<span class="uk-text-medium">{% autoescape off %}{{ chapter.text }}{% endautoescape %}</span><hr/>{% endif %}
	<div class="uk-grid-small uk-child-width-auto" uk-grid>
        <div>
             <button class="uk-button uk-button-text" type="button" uk-toggle="target: #chapter-{{chapter.id}}-comments">{{ chapter.comments.count}} Comment(s)</button>    		
        </div>
    </div>
    <div class="uk-grid-small uk-child-width-auto" uk-grid>
        <div id="chapter-{{chapter.id}}-comments" {% if not expand_comments %} hidden {% endif %}>
        		<ul class="uk-comment-list" id="chapter-{{chapter.id}}-comments-list">
        			{% include "chapter_comments.html" with post_action_url=chapter.post_action_url edit_action_url=chapter.edit_action_url next=chapter.comments.next next_params=chapter.comments.next_params comments=chapter.comments.results chapter_offset=chapter_offset %}   
        		</ul>  	  
        </div>        
    </div>
    {% if user_can_comment %}
     <div id="chapter-{{chapter.id}}-new">
        <form action="{{chapter.post_action_url}}" method="post" class="uk-form uk-grid-small" uk-grid>
            {% csrf_token %}
            <div class="uk-width-1-1"><input type="hidden" id="chapter" name="chapter" value="{{ chapter.id }}">
            	<textarea class="uk-textarea" id="text" name="text"></textarea>
            </div>
            <div class="uk-width-1-1">
            	<button class="uk-button uk-button-default uk-align-right">Post Comment</button>
            </div>
        </form>
    </div>
    {% endif %}
</div>
