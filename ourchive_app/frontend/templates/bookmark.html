{% extends 'index.html' %}
{% block content %}	
<div class="uk-width-1-1 uk-text-left" uk-grid id="bookmark-uk-grid">
	<script>
		function loadMoreComments(next, chapterId) {
			fetch(next)
			  .then((response) => {
			    return response.text();
			  })
			  .then((myText) => {			 
				document.getElementById('bookmark-{{bookmark.id}}-comments-child-container').innerHTML = "";
				document.getElementById('bookmark-{{bookmark.id}}-comments-child-container').innerHTML = myText;
				document.getElementById('bookmark-{{bookmark.id}}-comments-child-container').scrollIntoView();
			  });
		}
	</script>
	<article class="uk-article" id="bookmark-uk-article">
	    <div class="uk-child-width-2-1" id="bookmark-uk-child-grid" uk-grid>
	        <div class="uk-width-2-3" id="bookmark-title-parent">
	            <h1 id="bookmark-title-header" class="uk-article-title" style="display: inline;"><a class="uk-link-reset" id="bookmark-title-link" href="/bookmarks/{{ bookmark.id }}">{{ bookmark.title }}</a></h1> <span id="bookmark-user-span" class="uk-text-large" style="padding-left: 10px;"> bookmarked by {{bookmark.user}}</span>
	            {% if bookmark.draft %}
	            <div id="bookmark-draft-badge" class="uk-width-auto">
	                <span id="bookmark-draft-span" class="uk-label uk-label-warning"><strong id="bookmark-draft-text">DRAFT</strong></span>
	            </div>
	            {% endif %}
	        </div>
	        <div class="uk-text-right uk-width-1-3" id="bookmark-user-controls-parent">
	            {% if bookmark.user == request.user.username %}
	            {% if bookmark.draft %}
	            <a id="bookmark-publish-link" href="/bookmarks/{{ bookmark.id }}/publish"><span uk-icon="icon: check" title="Publish"></span> </a>
	            {% endif %}
	            <a id="bookmark-edit-link" href="/bookmarks/{{ bookmark.id }}/edit"><span uk-icon="icon: file-edit"></span> </a>
	            <a id="bookmark-delete-link" uk-toggle="target: #bookmark-{{bookmark.id}}-modal-delete"><span uk-icon="icon: trash"></span> </a>
	            {% include "delete_modal.html" with object='bookmark' object_id=bookmark.id %}
	            {% endif %}
	        </div>
	    <div class="uk-width-1" id="bookmark-work-link-parent">
	    	<span id="bookmark-work-link-span" class="uk-text-medium">Work link: <a id="bookmark-work-link-id" class="uk-link-reset" href="/works/{{ work.id }}">{{ work.title }} by {{work.user}}</a></span>
	    </div>
	    <div class="uk-width-1" id="bookmark-rating-parent">
	    	<p id="bookmark-description-hed" class="uk-text-medium"><span>{{bookmark.user}}'s rating:</span>
	    	{% for stars in rating_range %}
	            <div id="bookmark-star-parent" class="uk-animation-toggle uk-inline" tabindex="0">
	                <div id="bookkmark-star-child">
	                    {% if stars <= bookmark.rating %}
	                        <span id="bookmark-star-filled-span" uk-icon="icon: star" id="rating_{{stars}}" class="rating-star"></span>
	                    {% else %}
	                        <span id="bookmark-star-empty-span" uk-icon="icon: star" id="rating_{{stars}}"></span>
	                    {% endif %}
	                    
	                </div>
	            </div>
	        {% endfor %}
	    </div>	 
	    {% include "object_attributes.html" with object='bookmark' object_id=bookmark.id attributes=bookmark.attributes %}
	    <div class="uk-width-1" id="bookmark-description-parent">
	    	<p id="bookmark-description-hed" class="uk-text-large"><span>{{bookmark.user}} says:</span>
	    	<p id="bookmark-description-text" class="uk-text-medium">{{ bookmark.description|safe }}</p>
	    </div>	   
	    <hr id="bookmark-tag-hr" class="uk-divider-small"/>
	    {% if tags.items %}
		    <dl class="uk-description-list" id="bookmark-tag-parent">
		    {% for type, tag in tags.items %} 
		        <dt id="bookmark-tag-type">{{ type }}</dt>
		        <dd id="bookmark-tag-container">
		        <span id="bookmark-tag-icon" uk-icon="icon: tag"></span> {% for single_tag in tag %}<a href="{{single_tag.url}}" id="bookmark-tag-link" style="padding-left:5px;">{{ single_tag.display_text|default_if_none:single_tag.text }}</a> {% endfor %}
		        </dd>
		    {% endfor %}
		    </dl>
		    <hr id="bookmark-comments-hr" class="uk-divider-small"/>
	    {% endif %}
	    <div id="bookmark-comments-toggle-grid" class="uk-grid-small uk-child-width-auto" uk-grid>
	        <div id="bookmark-comments-toggle-row">
	             <button id="bookmark-comments-toggle" class="uk-button uk-button-text" type="button" uk-toggle="target: #bookmark-{{bookmark.id}}-comments">{{ comments.count}} Comments</button>    		
	        </div>
	    </div>
	    <div class="uk-child-width-expand" id="bookmark-{{bookmark.id}}-comments" {% if not expand_comments %} hidden {% endif %} uk-grid>
	        <div id="bookmark-{{bookmark.id}}-comments-child-container">
	        		{% include "bookmark_comments.html" with post_action_url=bookmark.post_action_url edit_action_url=bookmark.edit_action_url next=comments.next next_params=comments.next_params prev_params=comments.prev_params comments=comments.results comment_count=comments.count top_level="true" depth=1 current_offset=comment_offset %}
	        </div>
	    </div>
	    {% if user_can_comment %}
	    <div id="bookmark-{{bookmark.id}}-new">
            <form action="/bookmarks/{{bookmark.id}}/comments/new" method="post" class="uk-form uk-grid-small" id="bookmark-comment-form" uk-grid>
                {% csrf_token %}
                <label id="post-new-comment-label" class="uk-form-label uk-text-large" for="form-horizontal-text">New Comment</label>
                <div class="uk-width-1-1" id="bookmark-comment-form-parent">
                	<input type="hidden" id="bookmark-comment-hidden-input" name="bookmark" value="{{ bookmark.id }}">
                	<input type="hidden" id="bookmark-comment-count" name="bookmark_comment_count" value="{{comments.count}}"/>
                	<textarea rows="5" class="uk-textarea" id="bookmark-comment-input" name="text"></textarea>
                </div>
                {% if captcha_site_key %}
		        {% if not request.user.is_authenticated %}
		        <div class="uk-width-1-1 uk-margin-top">
		            <div class="h-captcha" data-sitekey="{{captcha_site_key}}"></div>
		              <script src="https://js.hcaptcha.com/1/api.js" async defer></script>
		        </div>
		        {% endif %}
		        {% endif %}
                <div class="uk-width-1-1" id="bookmark-comment-post-parent">
                	<button id="bookmark-comment-post-button" class="uk-button uk-button-default uk-align-right">Post Comment</button>
                </div>
            </form>
        </div>
        {% endif %}
	</article>
	</div>
	{% if scroll_comment_id %}
	    <script>
	        window.onload = function(){
	            document.getElementById("bk-comment-{{scroll_comment_id}}-icon-div").scrollIntoView();
	        }
	    </script>
{% endif %}
{% endblock %}