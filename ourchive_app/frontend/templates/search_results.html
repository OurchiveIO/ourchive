{% extends 'index.html' %}
{% load static %}
{% block title %}Search Results{% endblock %}
{% block content %}	
<link rel="stylesheet" href="{% static 'frontend/css/searchable-multiselect.css' %}" />
<script src="{% static 'frontend/js/searchable-multiselect.js' %}"></script>
<script>
	window.addEventListener("load", function(){
	    var activeTabs = localStorage.getItem('ourchive-active-tabs');
	  	if (activeTabs !== null) {
	  		activeTabs = activeTabs.split(",");
	  		activeTabs.forEach(function(tab) {
	  			var accordionItem = document.getElementById('accordion-item-'+tab);
    			if (accordionItem !== null && !accordionItem.classList.contains('uk-open')) {
    				UIkit.accordion(document.getElementById('search-accordion')).toggle(tab, false);
    				UIkit.accordion(document.getElementById('search-accordion-mobile')).toggle(tab, false);
    			}
	  		});
	  	}
	  	else {
	  		UIkit.accordion(document.getElementById('search-accordion')).toggle(0, false);
	  		UIkit.accordion(document.getElementById('search-accordion-mobile')).toggle(0, false);
	  	}

	  	if (localStorage.getItem('ourchive-show-filters') == null) {
	  		localStorage.setItem('ourchive-show-filters', '1');
		}
		if (localStorage.getItem('ourchive-show-filters') === '0') {
			UIkit.toggle(document.getElementById('search-results-toggle-button')).toggle();
		}
	});
	function updateFilterToggle() {
		var showFilters = localStorage.getItem('ourchive-show-filters');
		showFilters = showFilters === '1' ? '0' : '1';
		localStorage.setItem('ourchive-show-filters', showFilters);
	}
	function getFormVals(event) {
		event.preventDefault();
		link = event.target.href;
		var vals_form = document.forms["searchResultsForm_work"];
		vals_form.action = link;
		document.forms["searchResultsForm_work"].submit();
	}

	function updateActiveTab(index) {
		document.getElementById("active_tab").value = index;
	}

	function toggleAnyAll(include_exclude, flyover) {
		var all_toggle_label = include_exclude + "-all-toggle-label";
		var any_toggle_label = include_exclude + "-any-toggle-label";
		if (flyover != null) {
			all_toggle_label = all_toggle_label + "-flyover";
			any_toggle_label = any_toggle_label + "-flyover";
		}
		var toggle = document.getElementById(any_toggle_label).style.visibility;
		if (toggle === "hidden") {
			document.getElementById(any_toggle_label).style.visibility = "visible";
			document.getElementById(all_toggle_label).style.visibility = "hidden";
		}
		else {
			document.getElementById(any_toggle_label).style.visibility = "hidden";
			document.getElementById(all_toggle_label).style.visibility = "visible";
		}
	}

	function updateSortOrder(selected) {
		document.getElementById("search-results-sort-select-hidden").value = selected;
		document.forms["searchResultsForm_work"].submit()
	}
</script>
<div class="uk-width-1-1">
	<ul uk-tab="animation: uk-animation-fade; active: {{default_tab}}; connect: .search-switcher" id="search-results-switcher-controls" class="uk-flex-center uk-width-1-1 ourchive-padding-remove-horizontal">
	    <li id="results-switcher-li-works" class="ourchive-search-tab"><a href="#" id="works_tab" data-testid="works-tab" onclick="updateActiveTab(0)">Works ({{ works.page.count }})</a></li>
	    <li id="results-switcher-li-bookmarks" class="ourchive-search-tab"><a href="#" id="bookmarks_tab" onclick="updateActiveTab(1)">Bookmarks ({{ bookmarks.page.count }})</a></li>
	    <li id="results-switcher-li-users" class="ourchive-search-tab"><a href="#" id="users_tab" onclick="updateActiveTab(2)">Collections ({{ collections.page.count }})</a></li>
	    {% if not tag_id %}<li id="results-switcher-li-tags" class="ourchive-search-tab"><a href="#" id="tags_tab" onclick="updateActiveTab(3)">Tags ({{ tags.page.count }})</a></li>
	    <li id="results-switcher-li-users" class="ourchive-search-tab"><a href="#" id="users_tab" onclick="updateActiveTab(4)">Users ({{ users.data|length }})</a></li>{% endif %}
	</ul>
</div>
{% include 'search_results_filters.html' %}
<div class="uk-width-expand">
	<div id="selected-filters-list" class="uk-width-expand uk-margin-small-bottom">
		<!-- Selected filters go here -->
	</div>
	<div class="uk-width-expand uk-margin-bottom">
		<button class="uk-button uk-button-primary search-results-toggle uk-width-medium uk-inline" type="button" uk-toggle="target: .search-results-toggle" hidden id="search-results-toggle-button" onClick="updateFilterToggle()">Filter</button>
		<button class="uk-button uk-button-primary search-results-toggle uk-width-medium uk-inline uk-hidden@s" type="button" uk-toggle="target: #flyover-results" id="search-results-toggle-button-mobile" onClick="updateFilterToggle()">Filter</button>
		<select id="search-results-sort-select-visible" name="order_by" class="uk-select uk-width-medium" onchange="updateSortOrder(value)">
            <option id="search-results-sort-newest" value="-updated_on">Sort By: Last Updated</option>
            <option id="search-results-sort-oldest" value="-comment_count">Sort By: Comments</option>
        </select>
	</div>
	<div class="uk-switcher uk-margin-remove-left search-switcher uk-width-expand ourchive-padding-remove-horizontal uk-inline uk-height-viewport">
		<div class="uk-width-expand" id="search-results-works-parent">		
			{% for work in works.data %} 
				<div class="uk-margin-bottom">{% include "work_tile.html" %} </div>    
		    {% endfor %}
		    {% if works.data %}{% include 'pagination.html' with previous=works.page.prev_params next=works.page.next_params object_name='work_search' search_term=term %}{% endif %}
		</div>
				<div class="uk-width-expand" id="search-results-bookmarks-content">
		        {% for bookmark in bookmarks.data %} 
					<div class="uk-margin-bottom">{% include "bookmark_tile.html" %} </div>   
			    {% endfor %}
			    {% include 'pagination.html' with previous=bookmarks.page.prev_params next=bookmarks.page.next_params object_name='bookmark_search' search_term=term %}
			</div>   
			<div class="uk-width-expand" id="search-results-collections-content">
		        {% for bookmark_collection in collections.data %} 
					<div class="uk-margin-bottom">{% include "bookmark_collection_tile.html" %}</div>  
			    {% endfor %}
			    {% include 'pagination.html' with previous=collections.page.prev_params next=collections.page.next_params object_name='collection_search' search_term=term %}
			</div> 
			<div class="uk-width-expand" id="search-results-tags-content">
		        <dl class="uk-description-list uk-description-list-divider" id="search-results-tags-content-dl">
		        {% include "tag_partial.html" with obj_name='tag' tags=tags.data.items %}
		        {% include 'pagination.html' with previous=tags.page.prev_params next=tags.page.next_params object_name='tag_search' search_term=term %}
				</dl>
			</div> 
			<div uk-grid id="search-results-users-grid">
			<div class="uk-width-expand" id="search-results-users-content-parent">
		        {% for user in users.data %} 
					<p id="search-results-user-{{user.id}}"> <a id="search-results-user-{{user.id}}-link" href="{% url 'user-profile-parent' user.id %}">{{ user.username }}</a> </p>
			    {% endfor %}
			</div>  
		</div>
	</div>
</div>

{% endblock %}