{% extends 'index.html' %}
{% block content %}	
<div class="uk-child-width-1@m uk-child-width-1@s uk-text-left" uk-grid>  
<form class="uk-form-horizontal"  method="post" id="bookmarkForm">
    <script>
        function colorStar(starNum) {
            if (!document.getElementById("rating_"+starNum).classList.contains("rating-star")) {
                for (let star = 1; star <= starNum; star++) {
                    document.getElementById("rating_"+star).classList.add("rating-star");
                    document.getElementById("bookmark_rating").setAttribute("value", star);
                }                
            }
            else {
                for (let star = starNum; star <= 100; star++) {
                    var element = document.getElementById("rating_"+star);
                    if (element == null) break;
                    document.getElementById("rating_"+star).classList.remove("rating-star");                   
                } 
                document.getElementById("bookmark_rating").setAttribute("value", starNum - 1);               
            }
        }

        function removetag(tag, type) {
            document.getElementById("tags_"+tag+"_"+type).remove();
            document.getElementById("tags_"+tag+"_"+type+"_txt").remove();
        }

        function addtag(tag, type) {
            alert(document.getElementById(type+"_tags").innerHTML);
        }

        function tagCheck (e, type) {
            if (e.keyCode == 188 || e.keyCode == 13) {
                var section = document.getElementById(type+"_tags");
                var final = section.lastChild;
                final.value = final.value.replace(/,\s*$/, "");
                section.removeChild(section.lastChild);
                var wrapper= document.createElement('div');
                wrapper.innerHTML= '<input type="hidden" id="tags_'+final.value+'_'+type+'" name="tags_'+final.value+'_'+type+'" value="{\'url\': \'\', \'tag_type\': \''+type+'\', \'tag_type_id\': \'\', \'text\': \''+final.value+'\'}">';
                var div= wrapper.firstChild;
                section.appendChild(div);
                wrapper.innerHTML = '<div class="uk-inline" style="margin-right: 5px;"><span class="uk-badge" style="font-size: 14px; font-weight: bold; padding: 8px;" id="tags_'+final.value+'_'+type+'_txt">'+final.value+' <span uk-icon="close" onclick="removetag(\''+final.value+'\', \''+type+'\')" id="tags_'+final.value+'_'+type+'_delete"></span></span> </div>';
                div = wrapper.firstChild;
                section.appendChild(div);
                final.value = '';
                section.appendChild(final);
                section.lastChild.focus();
            }
        }
        
    </script>
    {% csrf_token %}
    <input type="hidden" name="bookmark_id" value="{{ bookmark.id }}">
    <div class="uk-child-width-1@m uk-child-width-1@s uk-text-left" uk-grid>
        <div class="uk-width-1-2">
            <span class="uk-text-large">Edit Bookmark</span>
        </div>
        <div class="uk-text-right uk-width-1-2">
            <input class="uk-button uk-button-danger" type="button" onclick="history.back()" value="Cancel"/>
            <button type="submit" disabled style="display: none" aria-hidden="true"></button>
            <input class="uk-button uk-button-primary" type="submit" value="Submit"/>
        </div>
    </div>
    <hr/>
        <ul class="uk-subnav uk-subnav-pill uk-subnav-divider uk-flex uk-flex-right" uk-switcher="animation: uk-animation-fade">
            <li></li>
        </ul>   
    

    <ul class="uk-switcher uk-margin">
        <li>
            <fieldset class="uk-fieldset">

                <div class="uk-margin">
                    <label class="uk-form-label" for="form-horizontal-text">Title</label>
                    <div class="uk-form-controls">
                        <div class="uk-inline">
                            <input class="uk-input uk-form-width-large" type="text" name="title" value="{{ bookmark.title|default_if_none:'' }}">
                        </div>
                    </div>
                    
                </div>

                <div class="uk-margin">
                    <label class="uk-form-label" for="form-horizontal-text">Description</label>
                    <div class="uk-form-controls">
                        <div class="uk-inline">
                            <textarea class="uk-textarea uk-form-width-large" rows="5" placeholder="Description" name="description">{{ bookmark.description|default_if_none:'' }}</textarea>
                        </div>
                    </div>
                    
                </div>

                <div class="uk-margin">
                    <label class="uk-form-label" for="form-horizontal-text">Rating</label>
                    <div class="uk-form-controls">
                        <div class="uk-inline">
                            <input type="hidden" name="rating" id="bookmark_rating" value="{{ bookmark.rating }}">
                            {% for stars in rating_range %}
                                <div class="uk-animation-toggle uk-inline" tabindex="0">
                                    <div class="uk-animation-fade">
                                        {% if stars <= bookmark.rating %}
                                            <span uk-icon="icon: star" onclick="colorStar({{stars}})" id="rating_{{stars}}" class="rating-star"></span>
                                        {% else %}
                                            <span uk-icon="icon: star" onclick="colorStar({{stars}})" id="rating_{{stars}}"></span>
                                        {% endif %}
                                        
                                    </div>
                                </div>
                            {% endfor %}
                            
                        </div>
                        
                    </div>
                </div>
                <div class="uk-margin">
                    <label class="uk-form-label" for="form-horizontal-text">Draft?</label>
                    <div class="uk-form-controls">
                        <div class="uk-inline">
                            <label for="draft"><input class="uk-checkbox" type="checkbox" name="draft" {% if bookmark.draft %} checked {% endif %}> </label>
                        </div>
                    </div>
                </div>

                <div class="uk-margin">
                    <label class="uk-form-label" for="form-horizontal-text">Allow Comments?</label>
                    <div class="uk-form-controls">
                        <select class="uk-select uk-form-width-large" name="comments_permitted">                    
                            <option {% if bookmark.anon_comments_permitted and bookmark.comments_permitted %} selected {% endif %}>All</option>
                            <option {% if bookmark.anon_comments_permitted == False and bookmark.comments_permitted %} selected {% endif %}>Registered users only</option>
                            <option {% if not bookmark.anon_comments_permitted and not bookmark.comments_permitted %} selected {% endif %}>None</option>

                        </select>
                    </div>
                </div>

                <div class="uk-margin">
                    <label class="uk-form-label" for="form-horizontal-text">Work</label>
                    <div class="uk-form-controls">
                        <div class="uk-inline">
                            <input class="uk-input uk-form-width-large" type="text" disabled="true" name="work_title" value="{{ bookmark.work.title }}">   
                            <input type="hidden" name="work_id" value="{{ bookmark.work.id }}">                         
                        </div>
                    </div>
                </div>

                
                {% for type, tag in tags.items %}
                <div class="uk-margin">
                    <label class="uk-form-label" for="form-horizontal-text">{{ type }}</label>
                    <div class="uk-form-controls">                
                        <div class="uk-inline">
                            <div id="{{ type }}_tags">
                            {% for single_tag in tag %}
                                <input type="hidden" id="tags_{{ single_tag.text }}_{{ type }}" name="tags_{{ single_tag.text }}_{{ type }}" value="{{ single_tag }}">
                                <div class="uk-inline" style="margin-right: 5px;"><span class="uk-badge" style="font-size: 14px; font-weight: bold; padding: 8px;"  id="tags_{{ single_tag.text }}_{{ type }}_txt">{{ single_tag.text }} <span uk-icon="close" onclick="removetag('{{single_tag.text}}', '{{type}}')" id="tags_{{ single_tag.text }}_{{ type }}_delete"></span></span></div>
                            {% endfor %}
                            <input class="uk-input uk-form-width-small uk-form-small uk-form-blank" type="text" id="{{ type }}_new_tag" onkeyup="tagCheck(event, '{{type}}')"></div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </fieldset>

        </li>
       
    </ul>
    <div class="uk-child-width-1@m uk-child-width-1@s uk-text-left" uk-grid>
        <div class="uk-text-right uk-width-1-1">
            <input class="uk-button uk-button-danger" type="button" onclick="history.back()" value="Cancel"/>
            <input class="uk-button uk-button-primary" type="submit" value="Submit"/>
        </div>
    </div>    
</form>
</div>
{% endblock %}