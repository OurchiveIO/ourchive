{% extends 'index.html' %}
{% block content %}	
{% load static %}
<script src="{% static 'frontend/js/tinymce.min.js' %}"></script>
<script>
function doBookmarkAutocomplete(term) {
  if (term.length < 5)
  {
    return;
  }
  var complete_select = 'bookmark-autocomplete-dropdown';
  fetch('/bookmark-autocomplete?text='+term+"&source=edit")
    .then((response) => {
      return response.text();
    })
    .then((templateText) => {      
    document.getElementById(complete_select).innerHTML = "";
    document.getElementById(complete_select).innerHTML = templateText;
    UIkit.drop(document.getElementById(complete_select)).show();
    });
}

function populateBookmarkInput(bookmark_id, bookmark_display) {
    // visible list
    var list = document.getElementById("bookmarks_readonly_list")
    // bookmark to add
    var final = bookmark_display;
    var wrapper= document.createElement('div');
    wrapper.innerHTML= '<input type="hidden" id="bookmarks_'+bookmark_id+'" name="bookmarks_'+bookmark_id+'" value="bookmarks_'+bookmark_id+'">';
    var div = wrapper.firstChild;
    list.appendChild(div);
    var li = document.createElement('li');
    li.innerHTML = bookmark_display+' (<a onclick="removeBookmark()">Remove</a>)';
    list.appendChild(li);
    document.getElementById("bookmark_entry").value = '';
    document.getElementById("bookmark_entry").focus();
    document.getElementById("bookmark-autocomplete-dropdown").innerHTML = "";
}
</script>
<div class="uk-child-width-1@m uk-child-width-1@s uk-text-left" id="bkcol-form-parent-grid" uk-grid>  
<form class="uk-form-horizontal" method="post" id="bookmarkForm" onsubmit="return getDescriptionText()">
    <script>
        function getDescriptionText() {
            document.getElementById('description').value = tinymce.get("descriptionEditor").getContent().replace(/\r?\n?/g, '');
        }
    </script>
    {% csrf_token %}
    <input id="bkcol-form-hidden-id" type="hidden" name="bookmark_id" value="{{ bookmark_collection.id }}"/>
    <div id="bkcol-form-actions-parent" class="uk-child-width-1@m uk-child-width-1@s uk-text-left" uk-grid>
        <div id="bkcol-form-header-parent" class="uk-width-1-2">
            <span id="bkcol-form-header-span" class="uk-text-large">Edit Bookmark Collection</span>
        </div>
        <div id="bkcol-form-actions-group" class="uk-text-right uk-width-1-2">
            <input id="bkcol-form-cancel" class="uk-button uk-button-secondary" type="button" onclick="history.back()" value="Cancel"/>
            <button id="bkcol-form-prevent-default-action-button" type="submit" disabled style="display: none" aria-hidden="true"></button>
            <input id="bkcol-form-submit" class="uk-button uk-button-primary" type="submit" value="Submit"/>
        </div>
    </div>
    <hr id="bkcol-form-hr"/>
            <fieldset id="bkcol-form-fieldset" class="uk-fieldset">

                <div id="bkcol-form-title-parent" class="uk-margin">
                    <label id="bkcol-form-title-label" class="uk-form-label" for="form-horizontal-text">Title</label>
                    <div id="bkcol-form-title-form-control" class="uk-form-controls">
                        <div id="bkcol-form-title-inline-div" class="uk-inline">
                            <input id="bkcol-form-title-input" class="uk-input uk-form-width-large" type="text" name="title" value="{{ bookmark_collection.title|default_if_none:'' }}">
                        </div>
                    </div>
                    
                </div>

                <div id="bkcol-form-description-parent" class="uk-margin">
                    <label id="bkcol-form-description-label" class="uk-form-label" for="form-horizontal-text">Description</label>
                    <div id="bkcol-form-description-form-controls" class="uk-form-controls">
                        <div id="bkcol-form-description-inline" class="uk-inline">
                            <input type="hidden" id="description" name="description" value="{{ bookmark_collection.description|safe|default_if_none:'' }}">
                            <textarea id="descriptionEditor"></textarea>
                            <script type="text/javascript">
                                              tinymce.init({
                                                selector: '#descriptionEditor',
                                        width: 600,
                                        height: 300,
                                        plugins: [
                                          'link', 'image', 'lists', 'charmap', 'preview', 'anchor', 'pagebreak',
                                          'fullscreen', 'insertdatetime',
                                          'media', 'table', 'emoticons'
                                        ],
                                        toolbar: 'undo redo | styles | bold italic | alignleft aligncenter alignright alignjustify | ' +
                                          'bullist numlist outdent indent | link image | print preview media fullscreen | ' +
                                          'forecolor backcolor emoticons | help',
                                        menubar: '',
                                        init_instance_callback : function(editor) {
                                            var descriptionText = document.getElementById('description').value;
                                            editor.setContent(descriptionText);
                                        }
                                      });
                            </script>
                        </div>
                    </div>
                </div>
                <hr id="bkcol-bookmarks-hr"/>
                <div class="uk-margin" id="bkcol-bookmarks-list">
                    <h3 id="bkcol-bookmarks-header">Collection Bookmarks <sup uk-icon="icon: question"></sup></h3>
                    <ul id="bookmarks_readonly_list"> 
                    {% for bookmark in bookmark_collection.bookmarks_readonly %}
                        <input type="hidden" id="bookmarks_{{bookmark.id}}" name="bookmarks_{{bookmark.id}}" value="bookmarks_{{bookmark.id}}"/>
                        <li>{{bookmark.title|default:bookmark.work.title}} (<a onclick="removeBookmark()">Remove</a>)</li>
                    {% endfor %}
                    </ul>
                    <div id="bkcol-form-bookmarks-parent" class="uk-margin">
                        <label id="bkcol-form-bookmarks-label" class="uk-form-label" for="form-horizontal-text">Add Bookmark</label>
                        <div id="bkcol-form-bookmarks-form-control" class="uk-form-controls">
                            <div id="bkcol-form-bookmarks-inline-div" class="uk-inline">
                                <input autocomplete="off" class="uk-input uk-form-width-medium uk-form-medium ourchive-tag-entry" type="text" placeholder="Search for bookmark..." id="bookmark_entry" oninput="doBookmarkAutocomplete(this.value)">
                                <div id="bookmark-autocomplete-dropdown" uk-drop></div>
                            </div>
                        </div>
                        
                    </div>
                </div>
                <hr id="bkcol-attributes-hr"/>
                {% include "object_attributes_form.html" with object='Bookmark Collection' attribute_types=bookmark_collection.attribute_types %}
                <hr id="bkcol-comments-hr"/>

                <div class="uk-margin" id="bkcol-form-draft-parent">
                    <label id="bkcol-form-draft-label" class="uk-form-label" for="form-horizontal-text">Draft?</label>
                    <div id="bkcol-form-draft-controls" class="uk-form-controls">
                        <div id="bkcol-form-draft-inline" class="uk-inline">
                            <label id="bkcol-form-draft-label" class="switch"><input id="bkcol-form-draft-input" class="uk-checkbox" type="checkbox" name="draft" {% if bookmark_collection.draft %} checked {% endif %}> <span class="slider round"></span> </label>
                        </div>
                    </div>
                </div>

                <div class="uk-margin" id="bkcol-form-allow-comments-parent">
                    <label id="bkcol-form-allow-comments-label" class="uk-form-label" for="form-horizontal-text">Allow Comments?</label>
                    <div id="bkcol-form-allow-comments-controls" class="uk-form-controls">
                        <select id="bkcol-form-allow-comments-select" class="uk-select uk-form-width-large" name="comments_permitted">                    
                            <option {% if bookmark_collection.anon_comments_permitted and bookmark_collection.comments_permitted %} selected {% endif %}>All</option>
                            <option {% if bookmark_collection.anon_comments_permitted == False and bookmark_collection.comments_permitted %} selected {% endif %}>Registered users only</option>
                            <option {% if not bookmark_collection.anon_comments_permitted and not bookmark_collection.comments_permitted %} selected {% endif %}>None</option>

                        </select>
                    </div>
                </div>
                {% include "edit_tags.html" with object='bookmark_collection' %}
            </fieldset>
    <div class="uk-child-width-1@m uk-child-width-1@s uk-text-left" id="bkcol-form-actions-footer-parent" uk-grid>
        <div class="uk-text-right uk-width-1-1" id="bkcol-form-actions-footer-child">
            <input id="bkcol-form-actions-footer-cancel" class="uk-button uk-button-secondary" type="button" onclick="history.back()" value="Cancel"/>
            <input id="bkcol-form-actions-footer-submit" class="uk-button uk-button-primary" type="submit" value="Submit"/>
        </div>
    </div>    
</form>
</div>
{% endblock %}