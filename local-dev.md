# Local Dev Set Up

Required:

- python 3.x +
- postgres 15+ [docs](https://www.postgresql.org/docs/15/index.html)


## Steps

1. Create local [venv](https://docs.python.org/3/library/venv.html) for your repo 
2. Activate venv and install required packages from [`requirements.txt`](requirements.txt)

	- if you get an install error for `psycopg2` that references `libpq-fe.h` like so:
	```
	      ./psycopg/psycopg.h:36:10: fatal error: libpq-fe.h: No such file or directory
         36 | #include <libpq-fe.h>
    ```
    check out [this](https://askubuntu.com/questions/1372562/how-to-install-libpq-dev-14-0-1-on-ubuntu-21-10)
3. For audio processing, install [ffmpeg](https://ffmpeg.org/download.html)
4. Log into postgres. Create a new database user and database according to the settings in settings.py. (Database name ourchive_db, database user ourchive, password generated by you.) Ensure that the ourchive user has correct permissions for the database (refer to [https://stackoverflow.com/questions/67276391/why-am-i-getting-a-permission-denied-error-for-schema-public-on-pgadmin-4](this) StackOverflow question for grants required.) 
5. Django leverages `dotenv` for loading environment variables. Copy `ourchive/ourchive_app/ourchive_app/.env-sample` into a new file, `.env`, in the same directory. 

`OURCHIVE_MAILGUN_API_KEY` can be left blank as it is not used for local development. `settings.py` sets the email backend to "file" for local development. Any emails the system sends will be saved as text in a `sent_emails` directory.

`OURCHIVE_MEDIA_ROOT` and `OURCHIVE_MEDIA_URL` should be set to ensure correct uploading and serving of files during local development. If `OURCHIVE_MEDIA_ROOT` is set to `/home/user/projects/ourchive/ourchive_app/files`, then `MEDIA_URL`should be `/files/` (the terminating folder in `OURCHIVE_MEDIA_ROOT`).

6. Ensure you have populated the database password and secret key into your `.env` file. `OURCHIVE_SECRET_KEY` can be any long, random string. We recommend using your password manager to generate one.
7. If you haven't done so already, activate your virtual environment. Then, from the `ourchive/ourchive_app` folder:

	```
	python manage.py migrate
	python manage.py loaddata api/fixtures/ourchivesettings
	python manage.py loaddata api/fixtures/attributetype
	python manage.py loaddata api/fixtures/attributevalue
	python manage.py loaddata api/fixtures/tagtype
	python manage.py loaddata api/fixtures/worktype
	python manage.py createsuperuser
	python manage.py runserver
	```

	and boom, you've got ourchive up and running. 

**IMPORTANT**: For local development, `OURCHIVE_DEV` should be set to `True` in your `.env` file. `ALLOWED_HOSTS` in `settings.py` assumes that your development site is running on `127.0.0.1:8000` for local development. If you are at a different URL, update `ALLOWED_HOSTS`.

Almost all variables in `settings.py` are used by Django or extensions, so if you see a variable you don't understand, check Django documentation or Google it. 

Some variables are Ourchive-specific and used in code; you can search the codebase to observe their usage.

To work with admin data, you can log into the Django admin console, located at `127.0.0.1:8000/admin`.

To work with API data, navigate to `127.0.0.1:8000/api`.

